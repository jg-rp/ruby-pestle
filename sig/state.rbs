module Pestle
  class ParserState
    @text: String

    @scanner: StringScanner

    @rules: Hash[String, Pestle::Grammar::Rule]

    @pos_checkpoints: Array[Integer]

    @atomic_depth: Integer

    @atomic_depth_checkpoints: Array[Integer]

    @tags: Array[String]

    @user_stack: Array[String]

    @user_stack_popped: Array[String]

    @user_stack_lengths: Array[[Integer, Integer]]

    @rule_stack: Array[String]

    @neg_pred_depth: Integer

    @suppress_failures: bool

    @furthest_pos: Integer

    @furthest_rules: Array[String]

    @furthest_expected: Hash[String, Array[String]]

    @furthest_unexpected: Hash[String, Array[String]]

    attr_reader text: String

    attr_reader scanner: StringScanner

    attr_reader rules: Hash[String, Pestle::Grammar::Rule]

    attr_reader tags: Array[String]

    attr_reader atomic_depth: Integer

    attr_reader user_stack: Array[String]

    attr_reader rule_stack: Array[String]

    attr_reader furthest_pos: Integer

    attr_reader furthest_expected:  Hash[String, Array[String]]

    attr_reader furthest_unexpected: Hash[String, Array[String]]
    
    attr_reader furthest_rules: Array[String]

    attr_accessor neg_pred_depth: Integer

    def initialize: (String text, Hash[String, Pestle::Grammar::Rule] rules, ?start_pos: ::Integer) -> void

    def checkpoint: () -> void

    def ok: () -> void

    def restore: () -> void

    def stack_snapshot: () -> void

    def stack_drop_snapshot: () -> void

    def stack_restore: () -> void

    def stack_empty?: () -> bool

    def stack_push: (String value) -> void

    def stack_pop: () -> String?

    def stack_peek: () -> String?

    def stack_peek_slice: (Integer? start, Integer? stop) -> Array[String]
                        
    def stack_clear: () -> void

    def parse_trivia: (Array[Pestle::Pair] pairs) -> bool
                    
    def with_tag: (String name) { () -> untyped } -> untyped
                
    def atomic: () { () -> untyped } -> untyped
              
    def nonatomic: () { () -> untyped } -> untyped
                 
    def record_failure: (String label, ?String? rule_name, ?force: bool) -> void
  end
end
